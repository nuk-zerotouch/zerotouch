<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ZeroTouch.UI.ViewModels"
             x:Class="ZeroTouch.UI.Views.DriverStateView"
             x:DataType="vm:DriverStateViewModel"
             IsVisible="{Binding IsFatigueActive}">

    <UserControl.Styles>
        <Style Selector="Grid.fatigue-card.animate Border#CardBorder">
            <Style.Animations>
                
                <Animation Duration="0:0:0.5"
                           IterationCount="Infinite"
                           PlaybackDirection="Alternate"
                           Easing="SineEaseInOut">
                    
                    <KeyFrame Cue="0%">
                        <Setter Property="BoxShadow" Value="0 0 20 #AA000000" />
                        <Setter Property="ScaleTransform.ScaleX" Value="1.0" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1.0" />
                    </KeyFrame>
                    
                    <KeyFrame Cue="100%">
                        <Setter Property="BoxShadow" Value="0 0 60 #FF0000" />
                        <Setter Property="ScaleTransform.ScaleX" Value="1.03" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1.03" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="Grid.fatigue-card.animate">
            <Style.Animations>
                <Animation Duration="0:0:0.3" FillMode="Forward">
                    
                    <KeyFrame Cue="0%">
                        <Setter Property="Opacity" Value="0" />
                    </KeyFrame>
                    
                    <KeyFrame Cue="100%">
                        <Setter Property="Opacity" Value="1" />
                    </KeyFrame>
                    
                </Animation>
            </Style.Animations>
        </Style>
    </UserControl.Styles>

    <!-- Semi-transparent backdrop -->
    <Grid Background="#80000000"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch">

        <Viewbox Stretch="Uniform" StretchDirection="Both">

            <Panel Margin="16">
                
                <Grid Width="1000"
                      Height="560"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Classes="fatigue-card"
                      Classes.animate="{Binding IsFatigueActive}"
                      RenderTransformOrigin="50%,50%">

                    <Grid.RenderTransform>
                        <TranslateTransform />
                    </Grid.RenderTransform>

                    <Border Name="CardBorder"
                            CornerRadius="30"
                            Background="#E6121212"
                            Padding="32"
                            BoxShadow="0 0 25 #0008"
                            RenderTransformOrigin="50%,50%">

                        <StackPanel
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="28">

                            <!-- Alert message -->
                            <TextBlock
                                Text="{Binding WarningText}"
                                Foreground="White"
                                FontSize="32"
                                TextAlignment="Center"
                                FontWeight="Bold" />

                            <TextBlock
                                Text="由左向右滑動以解除警告"
                                Foreground="#CCCCCC"
                                FontSize="18"
                                HorizontalAlignment="Center" />

                            <!-- Slide-to-dismiss bar -->
                            <Border
                                Width="420"
                                Height="64"
                                CornerRadius="32"
                                Background="#2A2A2A"
                                Padding="6">

                                <Grid>
                                    <!-- Slide progress fill -->
                                    <Border
                                        Background="#66FFFFFF"
                                        CornerRadius="32"
                                        Width="{Binding SlideProgress,
                                        Converter={StaticResource SlideToWidthConverter},
                                        ConverterParameter=420}" />

                                    <!-- Slider knob -->
                                    <Border
                                        Width="52"
                                        Height="52"
                                        CornerRadius="26"
                                        Background="White"
                                        HorizontalAlignment="Left"
                                        RenderTransformOrigin="0.5,0.5"
                                        PointerPressed="OnSliderPressed"
                                        PointerMoved="OnSliderMoved"
                                        PointerReleased="OnSliderReleased" />
                                </Grid>
                            </Border>
                        </StackPanel>
                    </Border>
                </Grid>
            </Panel>
        </Viewbox>
    </Grid>
</UserControl>
